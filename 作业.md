#Project3:直方图图像增强
***申文钦   自动化62 2160504046***
###一、把附件图像的直方图画出

我们常说的直方图是指频率分布直方图，即横坐标表示变量，纵坐标表示对每个变量取值的频率大小。在数字图像中，图像的直方图与之类似，横坐标是离散的灰度值，纵坐标是每个灰度值对应的像素点数目。  
所以直方图可以显示图像的明暗情况。越亮的图片直方图分布越靠右侧，越暗的图片直方图分布就越靠左侧；对比度越高的图片直方图分布越广，反之其分布较窄。  
在此题中我们需要同时读入图像的索引和调色板，再使用`ind2gray()`函数将索引图转化为灰度图像，之后调用内置函数`imhist()`画出，结果如下所示：
![原始图片](https://s2.ax1x.com/2019/03/19/AulPv6.png)
![直方图](https://s2.ax1x.com/2019/03/19/Aule5d.png)
结果分析:  

 一幅图像的直方图基本上可描述图像的概貌，如图像的阴暗状况和对比度等特征。因为直方图反映的是一个图像的灰度值的概率统计特征,我们可以通过修改直方图的方法来调整图像的灰度分布情况。

###二、把所有图像进行直方图均衡；输出均衡后的图像和源图像进行比对；分析改善内容
对于对比度较小的图片，我们通过对空域的数学操作使其灰度在一定范围内的像素数目大致相等，这个过程就是直方图均衡化。直观来讲，就是将不均匀的直方图调整的更加均匀。  这样处理往往能使对比度小、不易辨识的图片更加清楚。
使用`histeq()`函数实现直方图的均衡，结果如下：
![均衡化后图片](https://s2.ax1x.com/2019/03/19/Aul6IJ.png)
![均衡化后图片直方图](https://s2.ax1x.com/2019/03/19/AulRR1.png)
结果分析: 

对比可知，虽然直方图均衡可以提高整体的对比度,使图像清晰明亮,但也存在着以下缺点:1.变换后图像的灰度级减少，某些细节消失；2.某些图像，如直方图有高峰，经处理后对比度不自然的过分增强。

###三、进一步把图像按照对源图像直方图的观察，各自自行指定不同源图像的直方图，进行直方图匹配，进行图像增强
直方图均衡能自动地确定变换函数，该函数寻求产生有均匀直方图的输出图像。需要自动增强时，这是一种好方法，因为由这种技术得到的结果可以预知，并且这种方法实现也很简单。但对于某些应用，采用均匀直方图的基本增强并不是最好的方法。因此，我们需要直方图匹配，可以产生处理后有特殊的规定的直方图。  
实现步骤：

 1. 计算输入图像的均衡化直方图T(r)
 2. 计算模板图像的均衡化直方图G(z)
 3. 对于每个像素点的灰度r，找出使得T(r)=G(z)的z，若不存在则找最接近的，若有多个z值，则找最小的
 4. 将r依次替换为z
 
利用`imhist（)`函数求出模板的直方图，后用`histeq()`进行直方图匹配，结果如下：

![citywall-elain图片](https://s2.ax1x.com/2019/03/19/Au3wHU.png)	
![elain-lena图片](https://s2.ax1x.com/2019/03/19/Au8krV.png)	
结果分析：  
 匹配后的图像的直方图分布在整个空间当中，与模板图像的直方图形状更为相似。匹配后的图像对比度变大，图像可识别性增强，同时细节处还能比较清晰,但也存在某些细节消失，和部分部位对比度过度增强导致些许不自然，但整体效果较好。  

###四、对elain和lena图像进行7*7的局部直方图增强

局部直方图均衡的过程是定义个邻域，并把该区域的中心从一个像素移至另一个像素。在每个位置，计算邻域中的点的直方图，并且得到的不是直方图均衡化，就是规定化变换函数。这个函数最终用于映射邻域中心像素的灰度。然后，邻域的中心被移至一个相邻像素位置，并重复该过程。对邻域进行逐像素平移时，由于只有邻域中的行或列改变，所以可在每一步移动中，以新数据更新前一位置得到的直方图。这种方法与区域每移动一个像素位置就计算邻域中所有像素的直方图相比优点明显。有时用于减少计算量的另一种方法是，使用非重叠区域，但这种方法通常会产生我们不希望的“棋盘”效应。  
在实验中，首先产生一个7×7的模板，利用`padarray（）`函数对图像进行扩展。然后计算全图的灰度均值和方差、标准差;之后计算各像素点掩模覆盖区域参数（均值、标准差），再根据判断条件对像素点进行处理，结果如下：
![elain图片](https://s2.ax1x.com/2019/03/19/AuGpdO.png)
![lena图片](https://s2.ax1x.com/2019/03/19/AuGPFe.png)	
结果分析：  
可以发现，局部直方图均衡可以很大程度上增强图像的细节。但同时，它也使噪声更加明显，降低了图像的清晰度。  

###五、利用直方图对图像elain和woman进行分割

图像分割就是把图像分成若干个特定的、具有独特性质的区域并提出感兴趣目标的技术和过程。它是由图像处理到图像分析的关键步骤。现有的图像分割方法主要分以下几类：基于阈值的分割方法、基于区域的分割方法、基于边缘的分割方法以及基于特定理论的分割方法等。
 
具体做法为：在直方图中指定一个阈值，小于此阈值的灰度值均置0，大于此阈值的灰度值均置1 。阈值的选取采用如下迭代方法进行：
 1. 随机指定一个阈值，计算阈值左右两侧灰度的均值mean1,mean2
 2. 求出mean1与mean2的平均值作为新的阈值
 3. 重复上述过程直到两次阈值相差小于一个指定精度，得到最终阈值
在本次实验中。我设置初始阈值为128，精度为1，结果如下：
![woman图片](https://s2.ax1x.com/2019/03/19/AuGs61.png)	
![elain图片](https://s2.ax1x.com/2019/03/19/AuGTXt.png)
结果分析：   
如上图，把elain和woman的图像进行分割，切割的效果较为成功。


